<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>DiscreteChoiceModel</title>


<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}

kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb
}

* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}
</style>


</head>

<body>

<h1 id="toc_0">Discrete Choice Model</h1>

<ul>
<li>https://www2.warwick.ac.uk/fac/soc/economics/staff/ffwaldinger/teaching/ec9a8/slides/topic_1.pdf</li>
<li>stata journal</li>
<li>黃景沂 IO 講義</li>
<li>Discrete Choice Methods with Simulation,Kenneth Train</li>
<li>Bivariate extreme dis</li>
</ul>

<p>經濟學家假設消費者每次購買商品時，只購買一種商品，且數量為 1。這個假設乍聽之下很不合理，現實生活中的購物籃內容五花八門，也沒有數量的限制。但經濟學家關心的重要商品，許多都是人們一次只購買一個的，譬如房子、車子、電腦...等。即使不是這麼重大的消費行為，而是採購日常用品，人們也很少出現同一種商品一次購買大數量的情況。</p>

<p>我們將商品定義為一些特性(characteristics)的集合(bundles)，並定義消費者的效用來自這些特性，而不是商品本身。這樣定義效用有幾個好處，首先，真實世界的商品種類繁多，當我們在估計商品的需求與交叉彈性時，會讓問題的維度膨脹。譬如有 \(J\) 種商品，就有 \(J^2\) 個彈性。但是商品特性一般而言比商品數量的維度較低，可以簡化問題。其次，若我們將效用直接定義在商品上，當市場上出現全新商品時，我們無法評估它的需求。</p>

<h2 id="toc_1">random utility model (RUM)(McFadden)</h2>

<p>令 \(U_{ij}\) 表示消費者 \(i\) 選擇商品 \(j\) 的效用。假設有 \(j = 1...J\) 種商品可選， \(i\) 會從中選擇效用最高的商品。\(U_{ij}\) 取決於 \(i\) 的特性，\(j\) 的特性，以及兩者的交互作用。計量學家可以掌握一部分資訊，但並不是全部。因此計量學家將 \(U_{ij}\) 拆解成兩部分，一部分是已知的 \(V_{ij}\)；一部分是未知的，隨機的 \(\epsilon_{ij}\)：\[U_{ij} = V_{ij} + \epsilon_{ij}\]</p>

<p>對 \(i\) 而言，他總是會選效用最高的商品。但從計量學家的角度來看，\(i\) 的選擇有部分原因是未知的，是隨機的，每個商品都有機率變成效用最高的商品。令 \(P_{ij}\) 表示 \(i\) 選 \(j\) 的機率，亦即 \(U_{ij}\) 是 \(U_{i1}...U_{iJ}\) 中校用最高的機率。令 \(y_{ij} = 1\) 表示 \(i\) 選了商品 \(j\)，若 \(y_{ij} = 0\) 表示 \(i\) 沒有購買 \(j\)，則
\[P_{ij} = Pr(y_{ij} = 1) = Pr(U_{ij} \geq U_{ik}) = Pr(\epsilon_{ik}-\epsilon_{ij} \leq V_{ij} - V_{ik}), \forall k = 1...J \]</p>

<p>給定 \(V_{i1}...V_{iJ}\)，則 \(P_{ij}\) 取決於 \(\epsilon_{i1}...\epsilon_{iJ}\) 的聯合分配。若假設其為 Extreme Value 分配，可以推導出 \(P_{ij}\) 的 closed form。</p>

<p>有兩點值得注意：第一，\(P_{ij}\) 的值只跟效用的差距有關，若在 \(U_{i1}...U_{iJ}\) 裡都加入常數項 \(a\)，可得 \(Pr(U_{ij} +a \geq U_{ik} + a) = Pr(U_{ij} \geq U_{ik})\)。因此我們可以假設在 \(1...J\) 之外還有一個 outside good: 商品 \(0\)，而 \(1...J\) 被稱為 inside good。我們假設 outside good 帶來的效用為 \(0\)，如此便能將效用水準標準化。除此之外，outside good 也有 outside option 的意義，例如當 inside good 價格上漲時， outside good 的存在便允許消費者什麼也不買。</p>

<p>第二，\(P_{ij}\) 與效用的 scale 無關，若在將 \(U_{i1}...U_{iJ}\) 同乘常數 \(a\)，可得 \(Pr(aU_{ij} \geq aU_{ik}) = Pr(U_{ij} \geq U_{ik})\)。同樣地，我們也需要將效用的 scale 標準化。</p>

<h2 id="toc_2">conditional logit model</h2>

<p>conditional logit model (clogit) 假設 \(\epsilon_{i1}...\epsilon_{iJ}\) 為 i.i.d. 的 Extreme Value Type I 分配(又稱 Gumbel 分配)，且將 \(\epsilon\) 標準化，令其 CDF 為 \[F(\epsilon) = \exp[-e^{-x}]，\]此分配的變異數為 \(\pi^2/6\)，則\[P_{ij} = \frac{e^{V_{ij}}}{\sum_{k=1}^J e^{V_{ik}}}，\]
若將效用為 0 的 outside good 放入模型，意即 \(V_{i0} = 0\)，則
\[P_{ij} = \frac{e^{V_{ij}}}{1+\sum_{k=1}^J e^{V_{ik}}}。\]
若我們假設 \(i\) 是連續且同質的，則可以推導出商品 \(j\) 的 market share \(s_j = P_{ij}\)。</p>

<h3 id="toc_3">Independence of Irrelevant Alternatives(IIA)</h3>

<p>clogit 模型有 IIA 的特性，意思是說購買商品 \(j\), \(k\) 的相對機率或相對市佔率(odds ratio)，只跟 \(j\), \(k\) 有關，與消費者有多少其他選擇無關。
\[\frac{P_{ij}}{P_{ik}} = \frac{\exp(V_{ij})}{\exp(V_{ik})}。\]</p>

<p>IIA 的特性表示，如果我們引入新的產品，不會影響原先產品的相對市佔率。我們可以舉一個紅藍公車的例子來說明 IIA 會造成什麼問題。假設消費者原先只有兩個選項：走路或搭紅色公車去上班。如果消費者選擇走路或搭紅色公車的時間剛好一半一半，則 \(s_{iw} = s_{ir} = 0.5\)。odds ratio \(s_{iw}/s_{ir} = 1\)。現在客運公司新增一台藍色公車跑同樣的路線，根據 IIA， odds ratio \(s_{iw}/s_{ir}\) 還是為 1。但藍色公車與紅色公車為完全替代，消費者一樣花一半時間坐公車，一半時間走路，則時間分配應該為 \(s_{iw} = 0.5\)， \(s_{ir}= s_{ib} = 0.25\)。新的 odds ratio \(s_{iw}/s_{ir}\) 應該為 2。故如果引入新產品，IIA 特性會對新產品的預測產生問題。</p>

<h3 id="toc_4">價格彈性</h3>

<p>假設 \(V_{ij} = -\alpha p_j + x_j\beta\)。則
\[\frac{\partial s_{j}}{\partial p_j} = \left(\frac{e^{V_{ij}}}{\sum_{k=1}^J e^{V_{ik}}}\right)(-\alpha) - \frac{e^{V_{ij}}}{\left(\sum_{k=1}^J e^{V_{ik}}\right)^2}e^{V_{ij}}(-\alpha) = -\alpha s_{j} + \alpha s_{j}^2 = -\alpha s_{j}(1-s_{j})\]</p>

<p>\[\frac{\partial s_{k}}{\partial p_j} = -\frac{e^{V_{ik}}}{\left(\sum_{k=1}^J e^{V_{ik}}\right)^2}e^{V_{ij}}(-\alpha) = \alpha s_{j}s_{k}\]</p>

<p>因此價格彈性與交叉彈性為
\[\frac{\partial s_{j}/s_{j}}{\partial p_j/p_j} = -\alpha s_{j}(1-s_{j})\frac{p_j}{s_{j}} = -\alpha p_j(1-s_{j})\]</p>

<p>\[\frac{\partial s_{k}/s_{k}}{\partial p_j/p_j} = \alpha s_{j}s_{k}\frac{p_j}{s_{k}} = \alpha p_j s_{j}\]</p>

<p>這表示商品 \(j\) 對所有商品 \(k\) 的交叉彈性都是一樣的，只跟 \(j\) 自己的市佔率以及價格有關，與 \(j\), \(k\) 之間的相似性無關。 </p>

<h3 id="toc_5">likelihood function</h3>

<p>根據消費者一次只購買一種商品的假設，可得 \(\sum_{j=1}^J y_{ij} = 1\)。
欲估計的 likelihood function 為
\[\prod_{i=1}^I\prod_{j=1}^J P_{ij}^{y_{ij}}，\]
取 \(ln\) 可得 log-likelihood function 為
\[
\begin{aligned}
\sum_{i}\sum_j y_{ij}\ln P_{ij} &amp;= \sum_i\sum_j y_{ij} \left(V_{ij}-\ln \left( \sum_{k=1}^J e^{V_{ik}} \right) \right) \\
&amp; = \sum_i \left[ \sum_j y_{ij}V_{ij} - \left(\sum_j y_{ij}\right)\left( \ln \left( \sum_{k=1}^J e^{V_{ik}} \right) \right) \right]\\
&amp; = \sum_i \left[ \sum_j y_{ij}V_{ij} - \left( \ln \left( \sum_{k=1}^J e^{V_{ik}} \right) \right) \right]
\end{aligned}
\]</p>

<p>某些時候，可能存在某些 \(i, j, k, l\) 使得 \(P_{ij} = P_{kl}\)，則我們可以簡化 log-likelihood function。令 \(\{P&#39;_1,...,P&#39;_M\} = \cup \{ P_{ij} \}\)，\(c_m\) 表示 \(P&#39;_m\) 出現的次數，則 likelihood function
\[\prod_{i=1}^I\prod_{j=1}^J P_{ij}^{y_{ij}} = \prod_{m=1}^M {P&#39;_m}^{c_m}\]
取 \(ln\) 可得 log-likelihood function 為
\[\sum_m c_m \ln P&#39;_m\]
根據 \(P&#39;_m\) 的定義，可以找到一組 \(i,j\) 使得 \(P&#39;_m = P_{ij}\)，故可得
\[\sum_m c_m \ln P&#39;_m = \sum_m c_m \left(V_{ij}-\ln \left( \sum_{k=1}^J e^{V_{ik}} \right) \right)\]</p>

<p>雖然 \(\sum_{i}\sum_j y_{ij}\ln P_{ij}\) 與 \(\sum_m c_m \ln P&#39;_m\) 兩種 log-likelihood function 在數學上並沒有差異，但在數值分析時，後者形式比較簡單，可以加快運算速度。</p>

<h2 id="toc_6">Nested logit model</h2>

<p>若我們認為某些商品在消費者心中較為相似，則不能再假設 \(\epsilon_{i1}...\epsilon_{iJ}\) 為 i.i.d.。nlogit 模型將類似的商品分門別類，在同一類商品裡，IIA 成立，任意兩個同類商品的相對市佔率與其他同類商品無關；而兩個不同類的商品，IIA 不成立，它們的相對市佔率與商品的特性有關。</p>

<p>假設所有商品可以分成 \(B_1, B_2, ..., B_G\) 共 \(G\) 種類別，每個商品只會屬於其中一種類別。令 \(B_g\) 表示商品 \(j\) 所在的類別的所有商品。則消費者選擇 \(j\) 的行為可以想像成他先選擇 \(B_g\) 類別，再從 \(B_g\) 中選出 \(j\)。令 \(c_i\in\{1...J\}\) 表示 \(i\) 所購買的商品，則
\[P_{ij} = Pr(y_{ij} = 1) = Pr(c_{i} \in B_g)\cdot Pr(c_i = j | c_i \in B_g)\]</p>

<p>nlogit 假設 \(\epsilon_{i1}...\epsilon_{iJ}\) 的 CDF 為
\[F(\epsilon_{i1}...\epsilon_{iJ}) = \exp\left[ -\sum_{g=1}^G \left  (\sum_{j \in B_g}e^{-\epsilon_{ij}/\tau_g} \right)^{\tau_g} \right]\]
在這個分配下，若 \(j\), \(k\) 兩種商品來自同一個類別，則 \(\epsilon_{ij}\) 與 \(\epsilon_{ik}\) 相關: \(Cov(\epsilon_{ij}, \epsilon_{ik}) \neq 0\)。若兩種商品來自不同的類別，則  \(\epsilon_{ij}\) 與 \(\epsilon_{ik}\) 不相關: \(Cov(\epsilon_{ij}, \epsilon_{ik}) = 0\) </p>

<p>\(\tau_g\in[0, 1]\) 用來衡量 \(B_g\) 類別裡，不同商品之間的不相似性，\(\tau_g\) 越大，表示商品越獨立，越沒有相關性。\(\tau_g = 1\)，表示 \(B_g\) 類別裡的商品完全無關。若所有類別的 \(\tau_g\) 都是 1，表示所有商品都是彼此獨立的，等同於 clogit 模型。也有些人會用 \(\rho_g = 1-\tau_g\) 或 \(\mu_g = 1/\tau_g\) 來表示相關性，\(\rho_g\) 或 \(\mu_g\) 越大表示商品越有相關性。</p>

<p>根據 \(\tau_g\) 的定義，也有些人會將 \(\epsilon_{ij}\) 拆解成
\(\epsilon_{ij} = \zeta_{ig} + \tau_g\delta_{ij}\)，
使得 \(\delta_{i1}...\delta_{iJ}\) 為 i.i.d。</p>

<p>在上述的 CDF 之下，可得 
\[Pr(c_{i} = j | c_i \in B_g) = \frac{e^{V_{ij}/\tau_g}}{\sum_{k\in B_g}e^{V_{ik}/\tau_g}}\]
\[Pr(c_i\in B_g) = \frac{\left(\sum_{k\in B_g}e^{V_{ik}/\tau_g}\right)^{\tau_g}}{\sum_{m=1}^G\left(\sum_{k\in B_m}e^{V_{ik}/\tau_m}\right)^{\tau_m}} \]
\[P_{ij} = Pr(c_i \in B_g)\cdot Pr(c_i = j | c_i \in B_g) =\frac{e^{V_{ij}/\tau_g}\left(\sum_{k\in B_g}e^{V_{ik}/\tau_g}\right)^{\tau_g-1}}{\sum_{m=1}^G\left(\sum_{k\in B_m}e^{V_{ik}/\tau_m}\right)^{\tau_m}} \]
\[\frac{P_{ij}}{P_{ik}} = \frac{e^{V_{ij}/\tau_g}\left(\sum_{m\in B_g}e^{V_{im}/\tau_g}\right)^{\tau_g-1}}{e^{V_{ik}/\tau_h}\left(\sum_{m\in B_h}e^{V_{im}/\tau_h}\right)^{\tau_h-1}}, j\in B_g, k\in B_h\]
若 \(j\), \(k\) 來自同一個類別，意即 \(B_g = B_h\), \(\tau_g = \tau_h\)，則 \(P_{ij}/P_{ik} = e^{V_{ij}}/e^{V_{ik}}\)。意即在同一個類別內，\(j\), \(k\) 的相對市佔率與該類別內其他商品無關，IIA 成立。若 \(j\), \(k\) 來自不同類別，則相對市佔率與 \(B_g\), \(B_h\), \(\tau_g\), \(\tau_h\) 有關，但與這兩類商品以外的其他類別無關，稱為 Independence of Irrelevant Nests(IIN)。</p>

<h3 id="toc_7">價格彈性</h3>

<p>假設 \(V_{ij} = -\alpha p_j + x_j\beta\)。為了計算彈性，我們定義以下變數以方便計算：</p>

<ul>
<li>\(A_{jg} = e^{V_{ij}/\tau_g}\)</li>
<li>\(W_g = \sum_{j\in B_g} A_{jg}\)</li>
<li>\(Q = \sum_{g=1}^G W_g^{\tau_g}\)</li>
</ul>

<p>根據以上定義，
\[s_{j|B_g} = Pr(y_i = j | y_i \in B_g) = A_{jg}W_g^{-1}\]
\[s_{B_g} = Pr(y_i\in B_g) = W_g^{\tau_g}Q^{-1}\]
\[s_{j}=P_{ij} = A_{jg}W_g^{\tau_g-1}Q^{-1}\]</p>

<p>將 \(A_{jg}\), \(W_g\), \(Q\) 對 \(p_j\) 微分，可得
\[\frac{\partial A_{jg}}{\partial p_j} = e^{V_{ij}/\tau_g}\frac{-\alpha}{\tau_g} = -\frac{\alpha}{\tau_g}A_{jg}\]</p>

<p>\[\frac{\partial W_g}{\partial p_j} = \frac{\partial A_{jg}}{\partial p_j} = -\frac{\alpha}{\tau_g}A_{jg}, \text{where } j\in B_g \]</p>

<p>\[\frac{\partial W_g^{\tau_g-1}}{\partial p_j} = (\tau_g -1) W_g^{\tau_g-2}\frac{\partial W_g}{\partial p_j} =\alpha\frac{1-\tau_g}{\tau_g}A_{jg}W_g^{\tau_g-2}, \text{where  } j\in B_g \]</p>

<p>\[\frac{\partial Q}{\partial p_j} = \frac{\partial W_g^{\tau_g}}{\partial p_j} = \tau_g W_g^{\tau_g-1}\frac{\partial W_g}{\partial p_j} = -\alpha A_{jg}W_g^{\tau_g-1},\text{where  } j\in B_g \]</p>

<p>\[\frac{\partial Q^{-1}}{\partial p_j} = -Q^{-2}( -\alpha A_{jg}W_g^{\tau_g-1}) = \alpha A_{jg}W_g^{\tau_g-1}Q^{-2}, \text{where } j\in B_g\]</p>

<p>將市佔率對價格微分，可得
\[
\begin{aligned}
\frac{\partial s_{j}}{\partial p_j} &amp;= -\frac{\alpha}{\tau_g}A_{jg}W_g^{\tau_g-1}Q^{-1} + A_{jg}\left(\alpha\frac{1-\tau_g}{\tau_g}A_{jg}W_g^{\tau_g-2}\right)Q^{-1} +  A_{jg}W_g^{\tau_g-1}\left(  \alpha A_{jg}W_g^{\tau_g-1}Q^{-2}\right)\\
&amp;= -\frac{\alpha}{\tau_g}s_{j} + \alpha\frac{1-\tau_g}{\tau_g}s_{j}A_{jg}W_g^{-1} + \alpha s_{j}^2 \\
&amp;= -\alpha s_{j} \left(\frac{1}{\tau_g} - \frac{1-\tau_g}{\tau_g}s_{j|B_g}-s_{j} \right)
\end{aligned}
\]</p>

<p>若 \(j\), \(k\) 為同類商品，則
\[
\begin{aligned}
\frac{\partial s_{k}}{\partial p_j} &amp;= A_{kg}\left(\alpha\frac{1-\tau_g}{\tau_g}A_{jg}W_g^{\tau_g-2}\right)Q^{-1} +  A_{kg}W_g^{\tau_g-1}\left(  \alpha A_{jg}W_g^{\tau_g-1}Q^{-2}\right)\\
&amp;= A_{kg}W_g^{-1}\left(\alpha\frac{1-\tau_g}{\tau_g} \right)A_{jg}W_g^{\tau_g-1}Q^{-1} +\alpha\left(A_{kg}W_g^{\tau_g-1}Q^{-1}\right)\left(A_{jg}W_g^{\tau_g-1}Q^{-1}\right)\\
&amp;= \alpha\frac{1-\tau_g}{\tau_g}s_{k|B_g}s_j + \alpha s_k s_j \\
&amp; = \alpha s_j\left(\frac{1-\tau_g}{\tau_g}s_{k|B_g} +s_k \right)
\end{aligned} 
\]</p>

<p>若 \(j\), \(k\) 為不同類商品，則
\[
\begin{aligned}
\frac{\partial s_{k}}{\partial p_j} &amp;= A_{kg}W_g^{\tau_g-1}\left(  \alpha A_{jg}W_g^{\tau_g-1}Q^{-2}\right)\\
&amp;=\alpha\left(A_{kg}W_g^{\tau_g-1}Q^{-1}\right)\left(A_{jg}W_g^{\tau_g-1}Q^{-1}\right)\\
&amp;= \alpha s_k s_j 
\end{aligned} 
\]</p>

<p>因此價格彈性為
\[\frac{\partial s_j/s_j}{\partial p_j/p_j} =  -\alpha p_{j} \left(\frac{1}{\tau_g} - \frac{1-\tau_g}{\tau_g}s_{j|B_g}-s_{j} \right)\]</p>

<p>若 \(j\), \(k\) 為同類商品，則交叉彈性為
\[\frac{\partial s_k/s_k}{\partial p_j/p_j} = \alpha  p_j\left(\frac{s_j}{s_k}\right)\left(\frac{1-\tau_g}{\tau_g}s_{k|B_g} +s_k \right)=\alpha p_js_j\left(\frac{1-\tau_g}{\tau_g}\frac{1}{s_{B_g}}+1\right) \]</p>

<p>若 \(j\), \(k\) 為不同類商品，則交叉彈性為
\[\frac{\partial s_k/s_k}{\partial p_j/p_j} = \alpha p_js_j\]</p>

<h3 id="toc_8">likelihood function</h3>

<p>根據消費者一次只購買一種商品的假設，可得 \(\sum_{j=1}^J y_{ij} = 1\)。
欲估計的 likelihood function 為
\[\prod_{i=1}^I\prod_{j=1}^J P_{ij}^{y_{ij}}，\]
令 \(B_g\) 為 \(j\) 所在的類別，log-likelihood function 為
\[
\begin{aligned}
\sum_{i}\sum_j y_{ij}\ln P_{ij} &amp;= \sum_i\sum_j y_{ij} \left(\frac{V_{ij}}{\tau_g} + (\tau_g-1)\left(\ln \left(\sum_{j,k\in B_g}e^{V_{ik}/\tau_g}\right)\right)-\ln \left(\sum_{m=1}^G \left(\sum_{k\in B_m} e^{V_{ik}/\tau_m}\right)^{\tau_m} \right) \right) \\
&amp; = \sum_i \sum_j y_{ij} \left(\frac{V_{ij}}{\tau_g} + (\tau_g-1)\ln W_g - \ln Q\right) \\
&amp; = \sum_i \left( y_{ij}\left(\frac{V_{ij}}{\tau_g}+(\tau_g-1)\ln W_g  \right) -\ln Q\right)
\end{aligned}
\]</p>

<p>若同樣令 \(\{P&#39;_1,...,P&#39;_M\} = \cup \{ P_{ij} \}\)，\(c_m\) 表示 \(P&#39;_m\) 出現的次數，則 likelihood function
\[\prod_{i=1}^I\prod_{j=1}^J P_{ij}^{y_{ij}} = \prod_{m=1}^M {P&#39;_m}^{c_m}\]
取 \(ln\) 可得 log-likelihood function 為
\[\sum_m c_m \ln P&#39;_m\]
根據 \(P&#39;_m\) 的定義，可以找到一組 \(i,j\) 使得 \(P&#39;_m = P_{ij}\)，故可得
\[\sum_m c_m \ln P&#39;_m = \sum_m c_m \left(\frac{V_{ij}}{\tau_g} + (\tau_g-1)\ln W_g - \ln Q\right)\]</p>



<script type="text/x-mathjax-config">
(function () {

MathJax.Hub.Config({
	'showProcessingMessages': false,
	'messageStyle': 'none'
});

if (typeof MathJaxListener !== 'undefined') {
	MathJax.Hub.Register.StartupHook('End', function () {
		MathJaxListener.invokeCallbackForKey_('End');
	});
}

})();
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


</body>

</html>
